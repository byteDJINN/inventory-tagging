<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Update Sell State Test</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@3"></script>
    <script src="https://cdn.jsdelivr.net/gh/pocketbase/js-sdk@master/dist/pocketbase.umd.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
    </style>
</head>
<body>
    <div id="app">
        <h1>Update Sell State</h1>
        <input v-model="tagID" placeholder="Enter Tag ID" />
        <button @click="updatesellstate">Update Sell State</button>
        <p>{{ message }}</p>
    </div>

    <script>
        const { createApp, ref } = Vue;
        const pocketbase = new PocketBase('https://inventory.bytedjinn.com/db'); 

        createApp({
            setup() {
                const tagID = ref('');
                const message = ref('');

                async function updatesellstate() {
                    try {
                        // First, get records that has designated tagid
                        const records = await pocketbase.collection('items').getList(1,2,{
                            filter: `tagID = "${tagID.value}"` 
                        });
                        console.log("find records")
                        // check if getting the record 
                        if (records.items.length > 0) {
                            for (const record of records.items) {
                                // update record attribute
                                const updatedRecord = await pocketbase.collection("items").update(record.id, {
                                    timeSold: new Date().toISOString() // current time
                                });
                                console.log('Updated Record:', updatedRecord);
                            }
                            message.value = 'Records updated successfully.';
                        } else {
                            message.value = 'No records found with the specified tagID.';
                        }
                    } catch (error) {
                        console.error('Error updating timesold:', error);
                        message.value = 'Error updating timesold.';
                    }
                }

                return {
                    tagID,
                    updatesellstate,
                    message
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
