{% extends "base.html" %}
{% block content %}
{% raw %}

<div class="d-grid gap-3 vh-75" style="grid-template-columns: 1fr 2fr;">
    <div class="bg-body-tertiary border rounded-3 p-2">

        <h1>
            Stock in
            <span>( {{items.length}} )</span>
        </h1>

        <div class="btn-group w-100">
            <button class="btn btn-primary w-50" @click="submitItems">Submit</button>
            <button class="btn btn-primary w-50" @click="clear">Clear</button>
        </div>

        <div class="fs-4 ">
            <div class="mt-3">
                <label for="product-id">Product_id:</label>
                <input id="product-id" type="text" v-model="productId" class="form-control">
            </div>

            <div class="mt-3">
                <label for="product-title">Title:</label>
                <textarea id="product-title"v-model="productTitle" class="form-control"></textarea>
            </div>

            <div class="mt-3">
                <label for="product-size">Size:</label>
                <input id="product-size" type="text" v-model="size" class="form-control">
            </div>

            <div class="mt-3">
                <label for="product-colour">Colour:</label>
                <input id="product-colour" type="text" v-model="colour" class="form-control">
            </div>

            <div class="mt-3">
                <label for="product-price">Price:</label>
                <input type="text" v-model="price" class="form-control">
            </div>

        </div>


    </div>
    <div class="bg-body-tertiary border rounded-3 overflow-auto  ">
        <template v-if="items.length">
            <ul class="list-group" name="todolist" tag="ul">
                <li v-for="item in items" v-bind:key="item.product_id" class="list-group-item">
                    <span class="label w-50 ">{{item.title}}-{{item.product_id}} - {{ item.price }}</span>
                    <button class="btn btn-danger ms-3" @click="deleteItemFromList(item)">
                        delete
                    </button>

                </li>
            </ul>
        </template>
        <p v-else class="emptylist">Your list is empty.</p>
    </div>
</div>

<script>
    const oneProduct = '{"message": "Hello, World!", "product_id": "471823", "colour": "blue", "price": "267.9", "size": "XS", "category": "T-shirts", "brand": "Uniqlo", "title": "Uniqlo U AIRism Cotton Oversized Crew Neck Half Sleeve T-Shirt"}';
    const { createApp, reactive, ref, computed } = Vue
    const items = reactive([])
    const totalPrice = computed(() => {
        return items.reduce((sum, item) => sum + parseFloat(item.price), 0).toFixed(2);
    });
    const app = createApp({
        data() {
            return {
                message: 'Hello asdfsadVue!',
                items,
                totalPrice,
                productId: ref(''),
                size: ref(''),
                productTitle: ref(''),
                price: ref(''),
                colour: ref(''),
            }
        },
        methods: {
            greet(event) {
                const item = JSON.parse(oneProduct)
                item.product_id = Math.random().toString(10) + 1;
                this.items.push(item)
            },
            clear(e) {
                this.items.length = 0
            },
            deleteItemFromList(item) {
                let index = this.items.indexOf(item)
                this.items.splice(index, 1);
            },
            submitItems(e) {
                console.log(JSON.stringify(this.items))
                fetch('/products', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(this.items),
                })
                this.items.length = 0

            }

        }
    });
    app.mount('#app')


    socket.on('connect', function () {
        console.log('Connected');
    });
    socket.on('scan', function (data) {
        console.log(data);
        items.push(JSON.parse(data))
    });
</script>
{% endraw %}
{% endblock %}